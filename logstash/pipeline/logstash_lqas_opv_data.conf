input {
file {
        path => "/usr/share/logstash/files/lqas-opv-per-settlement-data/*"
        start_position => "beginning"
        type => "lqas_opv"
    }
}
filter {
  if [type] == "lqas_opv"{
  csv {
    autodetect_column_names => true
    autogenerate_column_names => false
  }
  date {
    match => ["IPDMonth","dd-MMM-yy", "dd-MMM-yyyy"]
    target => "IPDMonth"
  }
  mutate {
  lowercase => ["states"]
  gsub => [
    # remove all comma
    "states", ",", ""
  ]
  }
  }
}
output {
  if [type] == "lqas_opv"{
    elasticsearch {
        index => "lqas_opv_data"
        manage_template => true
        document_id => "%{LQASId}"
        template => "/usr/share/logstash/mapping/lqas_opv_mapping.json"
        template_name => "lqas_opv"
        hosts => "${ES_HOST}"

    }
   jdbc {
       connection_string => "${JDBC_STRING}/eoc_data"
       username => "${PSQL_USER}"
       password => "${PSQL_PASSWORD}"
       statement => ['INSERT INTO public.lqas_opv("LQASId", "IPDMonth", states, lgas, "Wards", "Starting_settlement", "GoodData", "DataComment", "Source", starttime, endtime, "Today", deviceid, "Name", "Lot", "Cluster", "Settlement_size", note1, "GPS_h1", "GPS_h1_latitude", "GPS_h1_longitude", "GPS_h1_altitude", "GPS_h1_precision", "Children_seen_h1", "Age_Child1", "Sex_Child1", "FM_Child1", "Reason_Not_FM1", "Caregiver_Aware_h1", "Total_OPVdoses_Child1", note1a, "Reason_Underimm_Child1", "PrevOPV_Child1", note2, "Children_seen_h2", "Age_Child2", "Sex_Child2", "FM_Child2", "Reason_Not_FM2", "Caregiver_Aware_h2", "Total_OPVdoses_Child2", note2a, "Reason_Underimm_Child2", "PrevOPV_Child2", note3, "Children_seen_h3", "Age_Child3", "Sex_Child3", "FM_Child3", "Reason_Not_FM3", "Caregiver_Aware_h3", "Total_OPVdoses_Child3", note3a, "Reason_Underimm_Child3", "PrevOPV_Child3", note4, "Children_Seen_h4", "Age_Child4", "Sex_Child4", "FM_Child4", "Reason_Not_FM4", "Caregiver_Aware_h4", "Total_OPVdoses_Child4", note4a, reason_underimm_child4, "PrevOPV_child4", note5, "Children_Seen_h5", "Age_Child5", "Sex_Child5", "FM_Child5", "Reason_Not_FM5", "Caregiver_Aware_h5", "Total_OPVdoses_Child5", note5a, "Reason_Underimm_Child5", "PrevOPV_Child5", "GPS_h5", "GPS_h5_latitude", "GPS_h5_longitude", "GPS_h5_altitude", "GPS_h5_precision", note6, "Children_Seen_h6", "Age_Child6", "Sex_Child6", "FM_Child6", "Reason_Not_FM6", "Caregiver_Aware_h6", "Total_OPVdoses_Child6", note6a, "Reason_Underimm_Child6", "PrevOPV_Child6", note7, "Children_Seen_h7", "Age_Child7", "Sex_Child7", "FM_Child7", "Reason_Not_FM7", "Caregiver_Aware_h7", "Total_OPVdoses_Child7", note7a, "Reason_Underimm_Child7", "PrevOPV_Child7", note8, "Children_Seen_h8", "Age_Child8", "Sex_Child8", "FM_Child8", "Reason_Not_FM8", "Caregiver_Aware_h8", "Total_OPVdoses_Child8", note8a, "Reason_Underimm_Child8", "PrevOPV_Child8", note9, "Children_Seen_h9", "Age_Child9", "Sex_Child9", "FM_Child9", "Reason_Not_FM9", "Caregiver_Aware_h9", "Total_OPVdoses_Child9", note9a, "Reason_Underimm_Child9", "PrevOPV_Child9", note10, "Children_Seen_h10", "Age_Child10", "Sex_Child10", "FM_Child10", "Reason_Not_FM10", "Caregiver_Aware_h10", "Total_OPVdoses_Child10", note10a, "Reason_Underimm_Child10", "PrevOPV_Child10", note11, "GPS_h10", "GPS_h10_latitude", "GPS_h10_longitude", "GPS_h10_altitude", "GPS_h10_precision", "Total_households", comments, add_settlements, note12, "meta/instanceID", id, uuid, submission_time, index, parent_table_name, parent_index, tags, notes, version, duration, submitted_by, "Campaign", phone_number)
	VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);', "LQASId", "IPDMonth", states, lgas, "Wards", "Starting_settlement", "GoodData", "DataComment", "Source", starttime, endtime, "Today", deviceid, "Name", "Lot", "Cluster", "Settlement_size", note1, "GPS_h1", "GPS_h1_latitude", "GPS_h1_longitude", "GPS_h1_altitude", "GPS_h1_precision", "Children_seen_h1", "Age_Child1", "Sex_Child1", "FM_Child1", "Reason_Not_FM1", "Caregiver_Aware_h1", "Total_OPVdoses_Child1", note1a, "Reason_Underimm_Child1", "PrevOPV_Child1", note2, "Children_seen_h2", "Age_Child2", "Sex_Child2", "FM_Child2", "Reason_Not_FM2", "Caregiver_Aware_h2", "Total_OPVdoses_Child2", note2a, "Reason_Underimm_Child2", "PrevOPV_Child2", note3, "Children_seen_h3", "Age_Child3", "Sex_Child3", "FM_Child3", "Reason_Not_FM3", "Caregiver_Aware_h3", "Total_OPVdoses_Child3", note3a, "Reason_Underimm_Child3", "PrevOPV_Child3", note4, "Children_Seen_h4", "Age_Child4", "Sex_Child4", "FM_Child4", "Reason_Not_FM4", "Caregiver_Aware_h4", "Total_OPVdoses_Child4", note4a, reason_underimm_child4, "PrevOPV_child4", note5, "Children_Seen_h5", "Age_Child5", "Sex_Child5", "FM_Child5", "Reason_Not_FM5", "Caregiver_Aware_h5", "Total_OPVdoses_Child5", note5a, "Reason_Underimm_Child5", "PrevOPV_Child5", "GPS_h5", "GPS_h5_latitude", "GPS_h5_longitude", "GPS_h5_altitude", "GPS_h5_precision", note6, "Children_Seen_h6", "Age_Child6", "Sex_Child6", "FM_Child6", "Reason_Not_FM6", "Caregiver_Aware_h6", "Total_OPVdoses_Child6", note6a, "Reason_Underimm_Child6", "PrevOPV_Child6", note7, "Children_Seen_h7", "Age_Child7", "Sex_Child7", "FM_Child7", "Reason_Not_FM7", "Caregiver_Aware_h7", "Total_OPVdoses_Child7", note7a, "Reason_Underimm_Child7", "PrevOPV_Child7", note8, "Children_Seen_h8", "Age_Child8", "Sex_Child8", "FM_Child8", "Reason_Not_FM8", "Caregiver_Aware_h8", "Total_OPVdoses_Child8", note8a, "Reason_Underimm_Child8", "PrevOPV_Child8", note9, "Children_Seen_h9", "Age_Child9", "Sex_Child9", "FM_Child9", "Reason_Not_FM9", "Caregiver_Aware_h9", "Total_OPVdoses_Child9", note9a, "Reason_Underimm_Child9", "PrevOPV_Child9", note10, "Children_Seen_h10", "Age_Child10", "Sex_Child10", "FM_Child10", "Reason_Not_FM10", "Caregiver_Aware_h10", "Total_OPVdoses_Child10", note10a, "Reason_Underimm_Child10", "PrevOPV_Child10", note11, "GPS_h10", "GPS_h10_latitude", "GPS_h10_longitude", "GPS_h10_altitude", "GPS_h10_precision", "Total_households", comments, add_settlements, note12, "meta/instanceID", id, uuid, submission_time, index, parent_table_name, parent_index, tags, notes, version, duration, submitted_by, "Campaign", phone_number]
   }
  }
}

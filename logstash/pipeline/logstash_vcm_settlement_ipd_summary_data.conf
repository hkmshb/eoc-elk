input {
file {
        path => "/usr/share/logstash/files/vcm-settlements-ipd-summary/*"
        start_position => "beginning"
        type => "vcm_settlement_ipd_summary"
    }
}
filter {
  if [type] == "vcm_settlement_ipd_summary"{
  csv {
    autodetect_column_names => true
    autogenerate_column_names => false
  }
  date {
    match => ["IPD_Date","yyyy-MM-dd","dd-MMM-yyyy","dd-MMM-yy"]
    target => "IPD_Date"
  }
  mutate {
  lowercase => ["State"]
  gsub => [
    # remove all comma
    "State", ",", ""
  ]
  }

  mutate {
  add_field => {
    "uniquekey" => "%{State} %{LGA} %{Ward} %{Settlement_Name} %{VCM_Name}"

  }
}
  }
}
output {
  if [type] == "vcm_settlement_ipd_summary"{
    elasticsearch {
        index => "vcm_settlement_ipd_summary_data"
        manage_template => true
        document_id => "%{uniquekey}"
        template => "/usr/share/logstash/mapping/vcm_settlement_ipd_summary_mapping.json"
        template_name => "vcm_settlement_ipd_summary"
        hosts => "${ES_HOST}"

    }
   jdbc {
       connection_string => "${JDBC_STRING}/eoc_data"
       username => "${PSQL_USER}"
       password => "${PSQL_PASSWORD}"
       unsafe_statement => "true"
       statement => ['INSERT INTO public.vcm_settlement_ipd_summary("SN", "IPD_Date", "VWS_Name", "VCM_Name", "Settlement_Name", "Settlement_Code", "State", "LGA", "Ward", "VCM_Type", "Report_Timeliness", "Tot_No_Children_Polio_Reg_Female", "Tot_No_Children_Polio_reg_Male", "Aged_Out_Female", "Aged_Out_Male", "Moved_Female", "Moved_Male", "Died_Female", "Died_Male", "Eligible_Children_Current_Campaign_Female", "Eligible_Children_Current_Campaign_Male", "U5_Vaccinated_FirstVist_Female", "U5_Vaccinated_FirstVist_Male", "U5_Vaccinated_ReVist_Female", "U5_Vaccinated_ReVist_Male", "Missed_Children_Playground_Female", "Missed_Children_Playground_Male", "Missed_Children_ScoialEvents_Female", "Missed_Children_ScoialEvents_Male", "Missed_Children_Market_Female", "Missed_Children_Market_Male", "Missed_Children_Farm_Female", "Missed_Children_Farm_Male", "Missed_Children_School_Female", "Missed_Children_School_Male", "Non-Compliance_Missed_Children_ChildSick_Female", "Non-Compliance_Missed_children_ChildSick_Male", "Non-Compliance_Missed_Children_SideEffects_Female", "Non-Compliance_Missed_Children_SideEffects_Male", "Non-Compliance_Missed_Children_NoFeltNeed_Female", "Non-Compliance_Missed_Children_NoFeltNeed_Male", "Non-Compliance_Missed_Children_TooManyRounds_Female", "Non-Compliance_Missed_Children_TooManyRounds_Male", "Non-Compliance_Missed_Children_ReligiousBeliefs_Female", "Non-Compliance_Missed_Children_ReligiousBeliefs_Male", "Non-Compliance_Missed_Children_PoliticalDifference_Female", "Non-Compliance_Missed_Children_PoliticalDifference_Male", "Non-Compliance_Missed_Children_UnhappyWithTeam_Female", "Non-Compliance_Missed_Children_UnhappyWithTeam_Male", "Non-Compliance_Missed_Children_NoPluses_Female", "Non-Compliance_Missed_Children_NoPluses_Male", "Non-Compliance_Missed_Children_NoGovService_Female", "Non-Compliance_Missed_Children_NoGovService_Male", "Non-Compliance_Missed_Children_PolioUncommon_Female", "Non-Compliance_Missed_Children_PolioUncommon_Male", "Non-Compliance_Missed_Children_PolioHasCure_Female", "Non-Compliance_Missed_Children_PolioHasCure_Male", "Non-Compliance_Missed_Children_OtherProtection_Female", "Non-Compliance_Missed_Children_OtherProtection_Male", "Non-Compliance_Missed_Children_NoFamilyConsent_Female", "Non-Compliance_Missed_Children_NoFamilyConsent_Male", "Household_Not_Visited_Female", "Household_Not_Visited_Male", "Security_Issues_Female", "Security_Issues_Male", "SN_Children_Referred_For_CMAM", "SN_Children_Referred_For_Suspected_AFP_Case", "SN_Children_Referred_For_Measle_Cases", "SN_Children_Referred_For_OtherDiseases", "Additional_Information",uniquekey)
	VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);', "SN", "IPD_Date", "VWS_Name", "VCM_Name", "Settlement_Name", "Settlement_Code", "State", "LGA", "Ward", "VCM_Type", "Report_Timeliness", "Tot_No_Children_Polio_Reg_Female", "Tot_No_Children_Polio_reg_Male", "Aged_Out_Female", "Aged_Out_Male", "Moved_Female", "Moved_Male", "Died_Female", "Died_Male", "Eligible_Children_Current_Campaign_Female", "Eligible_Children_Current_Campaign_Male", "U5_Vaccinated_FirstVist_Female", "U5_Vaccinated_FirstVist_Male", "U5_Vaccinated_ReVist_Female", "U5_Vaccinated_ReVist_Male", "Missed_Children_Playground_Female", "Missed_Children_Playground_Male", "Missed_Children_ScoialEvents_Female", "Missed_Children_ScoialEvents_Male", "Missed_Children_Market_Female", "Missed_Children_Market_Male", "Missed_Children_Farm_Female", "Missed_Children_Farm_Male", "Missed_Children_School_Female", "Missed_Children_School_Male", "Non-Compliance_Missed_Children_ChildSick_Female", "Non-Compliance_Missed_children_ChildSick_Male", "Non-Compliance_Missed_Children_SideEffects_Female", "Non-Compliance_Missed_Children_SideEffects_Male", "Non-Compliance_Missed_Children_NoFeltNeed_Female", "Non-Compliance_Missed_Children_NoFeltNeed_Male", "Non-Compliance_Missed_Children_TooManyRounds_Female", "Non-Compliance_Missed_Children_TooManyRounds_Male", "Non-Compliance_Missed_Children_ReligiousBeliefs_Female", "Non-Compliance_Missed_Children_ReligiousBeliefs_Male", "Non-Compliance_Missed_Children_PoliticalDifference_Female", "Non-Compliance_Missed_Children_PoliticalDifference_Male", "Non-Compliance_Missed_Children_UnhappyWithTeam_Female", "Non-Compliance_Missed_Children_UnhappyWithTeam_Male", "Non-Compliance_Missed_Children_NoPluses_Female", "Non-Compliance_Missed_Children_NoPluses_Male", "Non-Compliance_Missed_Children_NoGovService_Female", "Non-Compliance_Missed_Children_NoGovService_Male", "Non-Compliance_Missed_Children_PolioUncommon_Female", "Non-Compliance_Missed_Children_PolioUncommon_Male", "Non-Compliance_Missed_Children_PolioHasCure_Female", "Non-Compliance_Missed_Children_PolioHasCure_Male", "Non-Compliance_Missed_Children_OtherProtection_Female", "Non-Compliance_Missed_Children_OtherProtection_Male", "Non-Compliance_Missed_Children_NoFamilyConsent_Female", "Non-Compliance_Missed_Children_NoFamilyConsent_Male", "Household_Not_Visited_Female", "Household_Not_Visited_Male", "Security_Issues_Female", "Security_Issues_Male", "SN_Children_Referred_For_CMAM", "SN_Children_Referred_For_Suspected_AFP_Case", "SN_Children_Referred_For_Measle_Cases", "SN_Children_Referred_For_OtherDiseases", "Additional_Information",uniquekey]
   }
  }
}



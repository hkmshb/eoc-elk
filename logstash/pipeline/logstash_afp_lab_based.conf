input {
file {
        path => "/usr/share/logstash/files/afp-lab-based-dataset/*"
        start_position => "beginning"
        type => "afp_lab_based"
    }
}
filter {
  if [type] == "afp_lab_based"{
  csv {
    autodetect_column_names => true
    autogenerate_column_names => false
  }
  date {
    match => ["DateOfOnset", "dd-MMM-yy", "yy-MMM", "MMM-yyyy", "yyyy-MMM", "dd-MMM-yyyy"]
    target => "DateOfOnset"
  }
  }
  }

output {
  if [type] == "afp_lab_based"{
    elasticsearch {
        index => "afp_lab_based_data"
        manage_template => true
        document_id => "%{ICLabID}"
        template => "/usr/share/logstash/mapping/afp_lab_based_mapping.json"
        template_name => "afp_lab_based"
        hosts => "${ES_HOST}"

    }
   jdbc {
       connection_string => "${JDBC_STRING}/eoc_data"
       username => "${PSQL_USER}"
       password => "${PSQL_PASSWORD}"
       statement => ['INSERT INTO public.afp_lab_based("LabName", "EpidNumber", "ICLabID", "CaseOrContact", "SpecimenNumber", "NamesofPatient", "DateOfOnset", "DatelastOPV", "DateStoolCollected", "DateStoolSentToLab", "DateReceivedNatLevel", "DateSentICLab", "DateReceivedICLab", "StoolCondition", "DateFinalResultsSentNatLevel", "W1", "W2", "W3", "V1", "V2", "DateLRarmResults", "DateRLRArmResults", "CellCultureResultsLRarm", "CellCultureResultsRLRArm", "Vdpv_1", "Vdpv_2", "V3", "Rnpent", "DateITDSentNatLevel", "District", "Amapcode", "DateFinalCultureResults", "FinalCellCultureResult", "NEV", "DateReceivedITDResults", "Vdpv_3", "DateLArmIsolate", "DateRArmIsolate", "P1", "P2", "P3", "Npent", "RecStatus", "SequencingResultsCDC", "DateReferredtoCDC", "TotalOPVDoses", "DateSequencingresults", "Referredforfurtherconfirmation", "uniqueKey", "ITDLabID", "BESTMATCHW2SERO2", "GenotypeW2Sero2", "PercentMatchSabinSero3", "Vdpv2Cluster", "NucleotidediffVDPV2", "DateFinalrRTPCRResults", "NucleotidedifferenceW3", "RRTPCRVDPV_1", "DateFinalResultsSentReflabEPI", "ClusterW1sero1", "SelectedSeqSero3", "Sabin3", "SequenceName", "PercentMatchSabinSero1", "ITDLabName", "NucleotidediffSabin3", "PercentMatchSabin3", "RRTPCRVDPV_3", "DateIsolateRcvdForSeq", "NucleotidedifferenceW1", "DateSeqResult", "DateStoolReceivedNatLevel", "ClusterW3Sero3", "SelectedSeqSero1", "FTACardsent", "PercentMatchW2Sero2", "Vdpv2SequenceResults", "W2Sequence", "ITDMixture", "PercentMatchSabin2", "ClosestMatchVDPV3", "VDPV2SeqSero2", "DateLarmIsolateSentforITD", "DateIsolateinRegLab", "Sabin1", "Vdpv1SequenceResults", "RRTPCRITD", "BESTMATCHW3SERO3", "GenotypeW1Sero1", "RarmIsolateSentforITD", "FinalITDResult", "NucleotidediffVDPV3", "ClosestMatchVDPV1", "DateFinalCellCultureResults", "FTACARD", "NucleotidediffSabin1", "IDofreferredIsolate", "LabsentIsolate", "BESTMATCHW1Sero1", "GenotypeW3Sero3", "PercentMatchSabinSero2", "DateRlLRarmRec", "NucleotidediffVDPV1", "RRTPCRVDPV", "DateSeqResultsEntered", "NucleotidedifferenceW2", "RRTPCRVDPV_2", "IsolateCondition", "ClusterW2Sero2", "SelectedSeqSero2", "SequencingLab", "PercentMatchW3Sero3", "Province", "NucleotidediffSabin2", "Vdpv3SequenceResults", "Sabin2", "W1Sequence", "OtherSeqLab", "DateIsolateSentforSeq", "DateLarmIsolateRec", "VDPV1SeqSero1", "SourceOfIsolateSeq", "PercentMatchW1Sero1", "SourceOfIsolate", "LarmIsolatesentforITD", "W3Sequence", "PercentMatchSabin1", "ClosestMatchVDPV2", "VDPV3SeqSero3", "DateStoolReceivedinLab", "DateRarmIsolateSentforITD", "Dateisolatesentforsequencing", "Isolatesentforsequencing", "DateStoolSentfromField")
	VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);', "LabName", "EpidNumber", "ICLabID", "CaseOrContact", "SpecimenNumber", "NamesofPatient", "DateOfOnset", "DatelastOPV", "DateStoolCollected", "DateStoolSentToLab", "DateReceivedNatLevel", "DateSentICLab", "DateReceivedICLab", "StoolCondition", "DateFinalResultsSentNatLevel", "W1", "W2", "W3", "V1", "V2", "DateLRarmResults", "DateRLRArmResults", "CellCultureResultsLRarm", "CellCultureResultsRLRArm", "Vdpv_1", "Vdpv_2", "V3", "Rnpent", "DateITDSentNatLevel", "District", "Amapcode", "DateFinalCultureResults", "FinalCellCultureResult", "NEV", "DateReceivedITDResults", "Vdpv_3", "DateLArmIsolate", "DateRArmIsolate", "P1", "P2", "P3", "Npent", "RecStatus", "SequencingResultsCDC", "DateReferredtoCDC", "TotalOPVDoses", "DateSequencingresults", "Referredforfurtherconfirmation", "uniqueKey", "ITDLabID", "BESTMATCHW2SERO2", "GenotypeW2Sero2", "PercentMatchSabinSero3", "Vdpv2Cluster", "NucleotidediffVDPV2", "DateFinalrRTPCRResults", "NucleotidedifferenceW3", "RRTPCRVDPV_1", "DateFinalResultsSentReflabEPI", "ClusterW1sero1", "SelectedSeqSero3", "Sabin3", "SequenceName", "PercentMatchSabinSero1", "ITDLabName", "NucleotidediffSabin3", "PercentMatchSabin3", "RRTPCRVDPV_3", "DateIsolateRcvdForSeq", "NucleotidedifferenceW1", "DateSeqResult", "DateStoolReceivedNatLevel", "ClusterW3Sero3", "SelectedSeqSero1", "FTACardsent", "PercentMatchW2Sero2", "Vdpv2SequenceResults", "W2Sequence", "ITDMixture", "PercentMatchSabin2", "ClosestMatchVDPV3", "VDPV2SeqSero2", "DateLarmIsolateSentforITD", "DateIsolateinRegLab", "Sabin1", "Vdpv1SequenceResults", "RRTPCRITD", "BESTMATCHW3SERO3", "GenotypeW1Sero1", "RarmIsolateSentforITD", "FinalITDResult", "NucleotidediffVDPV3", "ClosestMatchVDPV1", "DateFinalCellCultureResults", "FTACARD", "NucleotidediffSabin1", "IDofreferredIsolate", "LabsentIsolate", "BESTMATCHW1Sero1", "GenotypeW3Sero3", "PercentMatchSabinSero2", "DateRlLRarmRec", "NucleotidediffVDPV1", "RRTPCRVDPV", "DateSeqResultsEntered", "NucleotidedifferenceW2", "RRTPCRVDPV_2", "IsolateCondition", "ClusterW2Sero2", "SelectedSeqSero2", "SequencingLab", "PercentMatchW3Sero3", "Province", "NucleotidediffSabin2", "Vdpv3SequenceResults", "Sabin2", "W1Sequence", "OtherSeqLab", "DateIsolateSentforSeq", "DateLarmIsolateRec", "VDPV1SeqSero1", "SourceOfIsolateSeq", "PercentMatchW1Sero1", "SourceOfIsolate", "LarmIsolatesentforITD", "W3Sequence", "PercentMatchSabin1", "ClosestMatchVDPV2", "VDPV3SeqSero3", "DateStoolReceivedinLab", "DateRarmIsolateSentforITD", "Dateisolatesentforsequencing", "Isolatesentforsequencing", "DateStoolSentfromField"]
   }
  }
}
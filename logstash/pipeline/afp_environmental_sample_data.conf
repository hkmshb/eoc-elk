input {
file {
        path => "/usr/share/logstash/files/afp-environmental-sample-dataset/*"
        start_position => "beginning"
        type => "afp_environmental_sample"
    }
}
filter {
  if [type] == "afp_environmental_sample"{
  csv {
    autodetect_column_names => true
    autogenerate_column_names => false
  }
  date {
    match => ["Datefinalcultureresult", "dd-MMM-yy", "yy-MMM",  "MMM-yyyy", "yyyy-MMM", "dd-MMM-yyyy"]
    target => "Datefinalcultureresult"
  }

  mutate {
  add_field => {
    "primarykey" => "%{IDNumber} %{Province} %{District} %{Sitename} %{UniqueKey}"                                           
  }
}
 
  }
  }

output {
  if [type] == "afp_environmental_sample"{
    elasticsearch {
        index => "afp_environmental_sample_data"
        manage_template => true
        document_id => "%{primarykey}"
        template => "/usr/share/logstash/mapping/afp_environmental_sample_mapping.json"
        template_name => "afp_environmental_sample"
        hosts => "${ES_HOST}"

    }
   jdbc {
       connection_string => "${JDBC_STRING}/eoc_data"
       username => "${PSQL_USER}"
       password => "${PSQL_PASSWORD}"
       unsafe_statement => "true"
       statement => ['INSERT INTO public.afp_environmental_sample("Datefinalcultureresult", "Dateresultstolab", "LabsentisolateforITD", "ITDlabID", "FTAcardsent", "DateF1recvd", "DateF2recvd", "DateF3recvd", "DateF4recvd", "DateF5recvd", "DateF6recvd", "Countryname", "Countrycode", "IDNumber", "Samplenumber", "Province", "Provincecode", "District", "Districtcode", "Sitename", "Healtharea", "Villagesettlement", "Timeofsamplecollection", "Atmospherictemperature", "Dateofcollection", "Datesamplesenttolab", "Tempsamplecarrier", "SampleIDnumber", "Samplecondition", "Ifpoorspecify", "Datesampleinlab", "OtherF1", "OtherF2", "OtherF3", "OtherF4", "Sitecode", "SpecimenVolume", "Colourofspecimen", "Labname", "Typeofsewage", "Labreferringspecimen", "ReferringlabID", "Dateofsampleprocess", "Volumeofconcentrate", "DateinocuL20B", "DateinoculatedinRD", "Flask1ID", "Flask2ID", "Flask3ID", "Flask4ID", "Flask5ID", "Flask6ID", "L20BF1", "L20BF2", "L20BF3", "L20BF5", "RDF6", "DateF1results", "DateF2results", "DateF3results", "L20BF4", "DateF4results", "DateF5results", "DateF6results", "DateF1RefITD", "DateF2RefITD", "DateF3RefITD", "DateF4RefITD", "DateF5RefITD", "DateF6RefITD", "Finalcellcultureresult", "P1PCRITDF1", "P2PCRITDF1", "P3PCRITDF1", "P1PCRITDF2", "P2PCRITDF2", "P3PCRITDF2", "P1PCRITDF3", "P2PCRITDF3", "P3PCRITDF3", "P1PCRITDF4", "P2PCRITDF4", "P3PCRITDF4", "P1PCRITDF5", "P2PCRITDF5", "P3PCRITDF5", "P1PCRITDF6", "P2PCRITDF6", "P3PCRITDF6", "OtherF5", "OtherF6", "PV1NSL", "Typeofsample2", "DateIsolrecdSeq2", "NameSeqLab2", "PV2NSL", "PV3NSL", "PV1SL", "PV2SL", "PV3SL", "PV1Discordant", "PV2Discordant", "DatefinalITDresF1", "DaterefSeqF1", "DaterefSeqF2", "DatefinalITDresF2", "PV3Discordant", "NPEV", "NEV", "SpeceimenID", "SpecimenIDSL2", "DateIsolSentSeq2", "DatefinalITDresF3", "DaterefSeqF3", "DatefinalITDresF4", "DaterefSeqF4", "SQW1Genotype", "SQW1Cluster", "SQW1EpidClosestMatch", "SQW1homologyClosestMatch", "SeqW1Name", "SeqW1comments", "SQVDPV1NtdiffSabin1", "SQVDPV1Group", "SQW2Genotype", "SQW2Cluster", "SQW2EpidClosestMatch", "SQW2homologyClosestMatch", "SQW2Name", "SQW2comments", "SQVDPV2NtdiffSabin2", "SpecimenIDVDPV3", "DatefinalITDresF5", "DaterefSeqF5", "DatefinalITDresF6", "DaterefSeqF6", "SQVDPV1EpidClosestMatch", "SQVDPV1homologyClosestMatch", "VDPV1Clasification", "SQVDPV1Name", "SQVDPV1comments", "SQSL1NtdiffSabin1", "SQSL1EpidClosestMatch", "SpecimenIDSL3", "FinalcombinedrRTPCRresults", "DateFinalCombinedResult", "DatefinalResultReported", "SQSL1homologyClosestMatch", "SQSL1Name", "SQSL1comments", "SQVDPV2Group", "SQVDPV2EpidClosestMatch", "SQVDPV2homologyClosestMatch", "VDPV2Clasification", "SQVDPV2Name", "SQVDPV2comments", "SQSL2NtdiffSabin2", "SQSL2EpidClosestMatch", "SQSL2homologyClosestMatch", "SQSL2Name", "SQSL2comments", "Typeofsample3", "DateIsolrecdSeq3", "DateIsolSentSeq3", "NameSeqLab3", "SpecimenID3", "SQW3Genotype", "SQW3Cluster", "SQW3EpidClosestMatch", "Serotype", "SQW3homologyClosestMatch", "SQW3Name", "SQW3comments", "SQVDPV3NtdiffSabin3", "SQVDPV3Group", "SQVDPV3EpidClosestMatch", "SQVDPV3homologyClosestMatch", "VDPV3Clasification", "SQVDPV3Name", "SQVDPV3comments", "DateIsolSentSeq4", "SQSL3NtdiffSabin3", "SQSL3EpidClosestMatch", "SQSL3homologyClosestMatch", "SQSL3Name", "SQSL3comments", "NameSeqLab4", "Othertypeofsewage", "Typeofsample1", "DateIsolSentSeq1", "NameSeqLab1", "DateIsolrecdSeq1", "SpeceimenID1", "SpecimenIDVDPV1", "SpecimenIDSL1", "SpecimenIDVDPV2", "DateIsolrecdSeq4", "SpecimenIDW4", "SQWCluster4", "SQWGenotype", "SQWEpidClosestMatch", "SQWhomologyClosestMatch", "SQWName", "SQWcomments", "SpecimenIDVDPV", "DateResSentOutW3", "DateResSentOutVDPV3", "DateResSentOutSL3", "DateResSentOutW1", "DateResSentOutVDPV1", "DateResSentOutSL1", "DateResSentOutW2", "DateResSentOutVDPV2", "DateResSentOutSL2", "SQVDPVNtdiffhomologSabin", "SQVDPVGroup", "SQVDPVEpidClosestMatch", "SQVDPVhomologyClosestMatch", "VDPVClasification", "SQVDPVName", "SQVDPVcomments", "SpecimenSL", "SQSLNtdiffhomologSabin", "SQSLEpidClosestMatch", "SQSLhomologyClosestMatch", "SQSLName", "SQSLcomments", "DaterRessentoutW", "SequenceNegative", "Typeofsewageplantorsystem", "SequencePerformed", "DateFinalSeqResult", "PV1", "PV2", "PV3", "RecStatus", "UniqueKey", primarykey)
                     VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);', "Datefinalcultureresult", "Dateresultstolab", "LabsentisolateforITD", "ITDlabID", "FTAcardsent", "DateF1recvd", "DateF2recvd", "DateF3recvd", "DateF4recvd", "DateF5recvd", "DateF6recvd", "Countryname", "Countrycode", "IDNumber", "Samplenumber", "Province", "Provincecode", "District", "Districtcode", "Sitename", "Healtharea", "Villagesettlement", "Timeofsamplecollection", "Atmospherictemperature", "Dateofcollection", "Datesamplesenttolab", "Tempsamplecarrier", "SampleIDnumber", "Samplecondition", "Ifpoorspecify", "Datesampleinlab", "OtherF1", "OtherF2", "OtherF3", "OtherF4", "Sitecode", "SpecimenVolume", "Colourofspecimen", "Labname", "Typeofsewage", "Labreferringspecimen", "ReferringlabID", "Dateofsampleprocess", "Volumeofconcentrate", "DateinocuL20B", "DateinoculatedinRD", "Flask1ID", "Flask2ID", "Flask3ID", "Flask4ID", "Flask5ID", "Flask6ID", "L20BF1", "L20BF2", "L20BF3", "L20BF5", "RDF6", "DateF1results", "DateF2results", "DateF3results", "L20BF4", "DateF4results", "DateF5results", "DateF6results", "DateF1RefITD", "DateF2RefITD", "DateF3RefITD", "DateF4RefITD", "DateF5RefITD", "DateF6RefITD", "Finalcellcultureresult", "P1PCRITDF1", "P2PCRITDF1", "P3PCRITDF1", "P1PCRITDF2", "P2PCRITDF2", "P3PCRITDF2", "P1PCRITDF3", "P2PCRITDF3", "P3PCRITDF3", "P1PCRITDF4", "P2PCRITDF4", "P3PCRITDF4", "P1PCRITDF5", "P2PCRITDF5", "P3PCRITDF5", "P1PCRITDF6", "P2PCRITDF6", "P3PCRITDF6", "OtherF5", "OtherF6", "PV1NSL", "Typeofsample2", "DateIsolrecdSeq2", "NameSeqLab2", "PV2NSL", "PV3NSL", "PV1SL", "PV2SL", "PV3SL", "PV1Discordant", "PV2Discordant", "DatefinalITDresF1", "DaterefSeqF1", "DaterefSeqF2", "DatefinalITDresF2", "PV3Discordant", "NPEV", "NEV", "SpeceimenID", "SpecimenIDSL2", "DateIsolSentSeq2", "DatefinalITDresF3", "DaterefSeqF3", "DatefinalITDresF4", "DaterefSeqF4", "SQW1Genotype", "SQW1Cluster", "SQW1EpidClosestMatch", "SQW1homologyClosestMatch", "SeqW1Name", "SeqW1comments", "SQVDPV1NtdiffSabin1", "SQVDPV1Group", "SQW2Genotype", "SQW2Cluster", "SQW2EpidClosestMatch", "SQW2homologyClosestMatch", "SQW2Name", "SQW2comments", "SQVDPV2NtdiffSabin2", "SpecimenIDVDPV3", "DatefinalITDresF5", "DaterefSeqF5", "DatefinalITDresF6", "DaterefSeqF6", "SQVDPV1EpidClosestMatch", "SQVDPV1homologyClosestMatch", "VDPV1Clasification", "SQVDPV1Name", "SQVDPV1comments", "SQSL1NtdiffSabin1", "SQSL1EpidClosestMatch", "SpecimenIDSL3", "FinalcombinedrRTPCRresults", "DateFinalCombinedResult", "DatefinalResultReported", "SQSL1homologyClosestMatch", "SQSL1Name", "SQSL1comments", "SQVDPV2Group", "SQVDPV2EpidClosestMatch", "SQVDPV2homologyClosestMatch", "VDPV2Clasification", "SQVDPV2Name", "SQVDPV2comments", "SQSL2NtdiffSabin2", "SQSL2EpidClosestMatch", "SQSL2homologyClosestMatch", "SQSL2Name", "SQSL2comments", "Typeofsample3", "DateIsolrecdSeq3", "DateIsolSentSeq3", "NameSeqLab3", "SpecimenID3", "SQW3Genotype", "SQW3Cluster", "SQW3EpidClosestMatch", "Serotype", "SQW3homologyClosestMatch", "SQW3Name", "SQW3comments", "SQVDPV3NtdiffSabin3", "SQVDPV3Group", "SQVDPV3EpidClosestMatch", "SQVDPV3homologyClosestMatch", "VDPV3Clasification", "SQVDPV3Name", "SQVDPV3comments", "DateIsolSentSeq4", "SQSL3NtdiffSabin3", "SQSL3EpidClosestMatch", "SQSL3homologyClosestMatch", "SQSL3Name", "SQSL3comments", "NameSeqLab4", "Othertypeofsewage", "Typeofsample1", "DateIsolSentSeq1", "NameSeqLab1", "DateIsolrecdSeq1", "SpeceimenID1", "SpecimenIDVDPV1", "SpecimenIDSL1", "SpecimenIDVDPV2", "DateIsolrecdSeq4", "SpecimenIDW4", "SQWCluster4", "SQWGenotype", "SQWEpidClosestMatch", "SQWhomologyClosestMatch", "SQWName", "SQWcomments", "SpecimenIDVDPV", "DateResSentOutW3", "DateResSentOutVDPV3", "DateResSentOutSL3", "DateResSentOutW1", "DateResSentOutVDPV1", "DateResSentOutSL1", "DateResSentOutW2", "DateResSentOutVDPV2", "DateResSentOutSL2", "SQVDPVNtdiffhomologSabin", "SQVDPVGroup", "SQVDPVEpidClosestMatch", "SQVDPVhomologyClosestMatch", "VDPVClasification", "SQVDPVName", "SQVDPVcomments", "SpecimenSL", "SQSLNtdiffhomologSabin", "SQSLEpidClosestMatch", "SQSLhomologyClosestMatch", "SQSLName", "SQSLcomments", "DaterRessentoutW", "SequenceNegative", "Typeofsewageplantorsystem", "SequencePerformed", "DateFinalSeqResult", "PV1", "PV2", "PV3", "RecStatus", "UniqueKey", primarykey]
   }
  }
}